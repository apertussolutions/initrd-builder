Quick and Dirty Guide
=====================

This is a set of scripts and config files I have used to build a zero touch
install of a hyperlaunch test environment on an existing system. The scripts
will help build the necessary pieces and then you will have to manual package
those pieces to be installed on the system.

Scripts
-------

There are three main scripts,

busybox-root:

    This will create a tarball with a busybox environment and necessary
    libraries. It assumes busybox is located in /bin, so you will need
    to ensure you have your distro's busybox package installed.

    It takes no parameters:
        $ ./scripts/busybox-root

generate-initrd:

    This will take all the pieces and make an initrd file. It is expecting the
    following files to be in packages directory,
        - busybox-root.tar.gz: generated by busybox-root script
        - kernelmods.tar.gz: tarball of /lib/modules for kernel
        - {xen version}/: directory generated by xen-packages
        - dom0-init/domu-init: init script for dom0 and domU initrd

    This script takes two parameters,
        1. image type, values are dom0 or domU
        2. xen version, should match version in packages/

xen-packages:

    This will package xen tools and libs for inclusion int initrd. It assumes
    there is a directory where xen.git has been checked out and build
    configured.

    Parameters are,
        1. xen dir
        2. packages dir

There are also the init scripts for a dom0 and a domU initrd located in the
packages directory.  They are cleverly named, dom0-init and domu-init,
respectively.

Device Tree
-----------

There is a dtb directory containing example device tree source files that have
been tested with hyperlaunch.

GRUB Config
-----------

There is a custom.cfg which will add a hyperlaunch submenu to GRUB.

Deploying
---------

The deployment tarball is built manually. Below is the directory layout where
everything is copied. This directory can be extracted on to an existing linux
distro and should not interfere with the host system.

deploy
└── boot
    ├── grub
    │   └── custom.cfg
    └── hyperlaunch
        ├── initramfs-dom0.img
        ├── initramfs-domU.img
        ├── multi-pvh.dtb
        ├── multi-pv-pvh.dtb
        ├── pv-dom0-only.dtb
        ├── pvh-dom0-only.dtb
        ├── vmlinuz
        └── xen.gz

Given the above layout, to build the tarball,
    tar -C deploy -zcf deploy.tar.gz .

And the host system, the tarball can be applied by,
    sudo tar -C / -xf deploy.tar.gz

After the initial install, individual pieces can be replace or edited
accordingly.
