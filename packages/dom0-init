#!/bin/sh

for d in proc sys dev; do
	if ! test -d /${d}; then
		mkdir /proc
	fi
done

mount -t proc proc /proc
mount -t sysfs sysfs /sys
mount -t devtmpfs devtmpfs /dev

mkdir /dev/pts
mount -t devpts devpts /dev/pts

if test -d /proc/xen ; then
	mount -t xenfs xenfs /proc/xen
fi

echo 0 > /proc/sys/kernel/printk

modprobe xen-gntdev
modprobe xen-gntalloc

/usr/sbin/xenstored --pid-file /var/run/xen/xenstored.pid

/usr/lib/xen/bin/xen-init-dom0

/usr/sbin/xenconsoled

exec /bin/ash
